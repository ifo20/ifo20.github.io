<!DOCTYPE html>
<html lang="en-gb">

<head>
	<title>TBC</title>
	<meta charset="utf-8">
	<meta name="viewport"
		content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale-1, user-scalable-0" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
	<script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
	<style>
		canvas {
			display: block;
			margin: 0;
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
		}
	</style>
</head>

<body>
	<script>
		function resize() {
			var canvas = document.querySelector("canvas");
			var windowWidth = window.innerWidth;
			var windowHeight = window.innerHeight;
			var windowRatio = windowWidth / windowHeight;
			var gameRatio = game.config.width / game.config.height;

			if (windowRatio < gameRatio) {
				canvas.style.width = windowWidth + "px";
				canvas.style.height = (windowWidth / gameRatio) + "px";
			}
			else {
				canvas.style.width = (windowHeight * gameRatio) + "px";
				canvas.style.height = windowHeight + "px";
			}
		}
		var config = {
			type: Phaser.AUTO,
			width: 800,
			height: 600,
			physics: {
				default: 'arcade',
				arcade: {
					gravity: { y: 200 }
				}
			},
			scene: {
				preload: preload,
				create: create,
				update: update,
			}
		};
		var player;
		var stars;
		var platforms;
		var cursors;
		var score = 0;
		var scoreText;
		var game = new Phaser.Game(config);

		function preload() {
			this.load.image('sky', 'sky.png');
			this.load.image('ground', 'platform.png');
			this.load.image('star', 'star.png');
    			this.load.image('bomb', 'bomb.png');
			this.load.spritesheet('dude', 'spritesheet.png', {frameWidth: 32, frameHeight: 48})
		}
		function create() {
			this.add.image(400, 300, 'sky')
			platforms = this.physics.add.staticGroup()
			platforms.create(400, 568, 'ground').setScale(2).refreshBody(1)
			platforms.create(600, 400, 'ground')
			platforms.create(50, 250, 'ground')
			platforms.create(750, 220, 'ground')
			
			player = this.physics.add.sprite(100, 450, 'dude');
			player.setBounce(0.2);
			player.setCollideWorldBounds(true);

			this.anims.create({
			    key: 'left',
			    frames: this.anims.generateFrameNumbers('dude', { start: 11, end: 24 }),
			    frameRate: 10,
			    repeat: -1
			});

			this.anims.create({
			    key: 'turn',
			    frames: [ { key: 'dude', frame: 24 } ],
			    frameRate: 20
			});

			this.anims.create({
			    key: 'right',
			    frames: this.anims.generateFrameNumbers('dude', { start: 0, end: 11 }),
			    frameRate: 10,
			    repeat: -1
			});
			cursors = this.input.keyboard.createCursorKeys();

			stars = this.physics.add.group({
			    key: 'star',
			    repeat: 11,
			    setXY: { x: 12, y: 0, stepX: 70 }
			});
			stars.children.iterate(function (child) {
			    child.setBounceY(Phaser.Math.FloatBetween(0.4, 0.8));
			});

			scoreText = this.add.text(16, 16, 'score: 0', { fontSize: '32px', fill: '#000' });
			this.physics.add.collider(player, platforms);
			this.physics.add.collider(stars, platforms);

			this.physics.add.overlap(player, stars, collectStar, null, this);
		}
		function update() {
			if (cursors.left.isDown)
			{
			    player.setVelocityX(-160);

			    player.anims.play('left', true);
			}
			else if (cursors.right.isDown)
			{
			    player.setVelocityX(160);

			    player.anims.play('right', true);
			}
			else
			{
			    player.setVelocityX(0);

			    player.anims.play('turn');
			}

			if (cursors.up.isDown && player.body.touching.down)
			{
			    player.setVelocityY(-330);
			}

		}
		function collectStar (player, star)
		{
		    star.disableBody(true, true);

		    score += 10;
		    scoreText.setText('Score: ' + score);
		}

		
	</script>

</body>

</html>
